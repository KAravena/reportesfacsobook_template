<script>
document.addEventListener('DOMContentLoaded', () => {
  const chapterNumbers = document.querySelectorAll('.sidebar .chapter-number');
  let counter = 1;

  chapterNumbers.forEach((el, idx) => {
    const value = el.textContent.trim();

    if (idx === 0) {
      const sibling = el.nextSibling;
      el.textContent = '';
      el.style.display = 'none';
      if (sibling && sibling.nodeType === Node.TEXT_NODE) {
        sibling.remove();
      }
      return;
    }

    if (/^\d+$/.test(value)) {
      el.textContent = String(counter);
      counter += 1;
    }
  });

  document.querySelectorAll('[data-number]').forEach((el) => {
    const link = el.closest('a');
    const href = (link && link.getAttribute('href')) || el.getAttribute('href');
    if (href && href.includes('index.html')) {
      el.setAttribute('data-number', '');
      return;
    }

    const current = el.getAttribute('data-number');
    if (!current || !/^\d+$/.test(current)) {
      return;
    }

    const num = parseInt(current, 10);
    if (!Number.isNaN(num) && num > 0) {
      el.setAttribute('data-number', String(Math.max(num - 1, 1)));
    }
  });
});
</script>
