<script>
document.addEventListener('DOMContentLoaded', () => {
  const organizeSidebar = () => {
    const menu = document.querySelector('.sidebar .sidebar-menu-container ul');
    if (!menu || menu.dataset.facsoOrganized === 'true') {
      return false;
    }

    const items = Array.from(menu.children).filter((li) =>
      li.classList.contains('sidebar-item')
    );
    if (items.length === 0) {
      return false;
    }

    const createHeading = (text) => {
      const li = document.createElement('li');
      li.className = 'sidebar-heading';
      li.textContent = text;
      return li;
    };

    const abstractItem = items[0];
    const prefaceItem = items[1];

    if (abstractItem) {
      const number = abstractItem.querySelector('.chapter-number');
      if (number) {
        const sibling = number.nextSibling;
        number.remove();
        if (sibling && sibling.nodeType === Node.TEXT_NODE) {
          sibling.remove();
        }
      }
    }

    if (abstractItem) {
      menu.insertBefore(createHeading('PresentaciÃ³n'), abstractItem);
    }

    const firstChapter = items[2];
    if (firstChapter) {
      menu.insertBefore(createHeading('Informe'), firstChapter);
    }

    menu.dataset.facsoOrganized = 'true';
    return true;
  };

  const ensureOrganized = () => {
    if (organizeSidebar()) {
      return;
    }

    const observer = new MutationObserver(() => {
      if (organizeSidebar()) {
        observer.disconnect();
      }
    });

    observer.observe(document.body, { childList: true, subtree: true });
  };

  ensureOrganized();
  document.addEventListener('quarto:navChanged', ensureOrganized);
});
</script>
